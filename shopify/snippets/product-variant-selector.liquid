{%- assign selected_variant = product.selected_or_first_available_variant -%}
{%- assign color_label = 'color,colour,couleur,cor,colore,farbe,색,色,カラー,färg,farve,szín,barva' | split: ',' -%}
{%- assign texture_label = 'texture,finish,acabado,finition,textur,질감,質地,テクスチャ,textura' | split: ',' -%}

{%- comment -%}
CUSTOM: Check if online price should be hidden via metafield
If custom.hide_online_price is true, skip price and quantity display
{%- endcomment -%}
{%- assign hide_online_price = product.metafields.custom.hide_online_price -%}

{%- comment -%}Hidden input for variant ID - required by variant picker JavaScript{%- endcomment -%}
<input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">

{%- comment -%}Check if this product has custom size selector data (Techo-Bloc){%- endcomment -%}
{%- assign has_size_diagram = false -%}
{%- for variant in product.variants -%}
  {%- if variant.metafields.custom.size_diagram_image != blank -%}
    {%- assign has_size_diagram = true -%}
    {%- break -%}
  {%- endif -%}
{%- endfor -%}

{%- unless product.has_only_default_variant -%}
  <variant-picker handle="{{ product.handle }}" section-id="{{ section.id }}" form-id="{{ product_form_id }}" {% if update_url %}update-url{% endif %} {% if block.settings.hide_sold_out_variants %}hide-sold-out-variants{% endif %} class="product-form__variants" {{ block.shopify_attributes }}>
    {%- comment -%}
    The variant data is outputted as a JSON, which allows the theme to emit an event with the data when the variant changes. This must not be removed.
    {%- endcomment -%}
    <script data-variant type="application/json">
      {{- product.selected_or_first_available_variant | json -}}
    </script>

    {%- if has_size_diagram -%}
      {%- comment -%}Render custom Techo-Bloc size selector{%- endcomment -%}
      {%- render 'custom-size-selector', product: product, section: section -%}
    {%- else -%}
      {%- comment -%}Render standard Warehouse variant selector{%- endcomment -%}
      {%- for option in product.options_with_values -%}
        {%- assign downcase_option = option.name | downcase -%}
        {%- capture option_name -%}option{{ option.position }}{%- endcapture -%}

        {%- assign option_selector_type = block.settings.selector_mode -%}
        {%- assign variant_image_options = block.settings.variant_image_options | replace: ', ', ',' | downcase | split: ',' -%}

        {%- assign swatch_count = option.values | map: 'swatch' | compact | size -%}

        {%- comment -%}
        CUSTOM: Check if this option has metafield swatches (Color, Texture, or Size)
        {%- endcomment -%}
        {%- assign has_metafield_swatches = false -%}
        {%- assign metafield_swatch_key = nil -%}
        {%- assign is_size_option = false -%}

        {%- comment -%}Check if option name contains "color"{%- endcomment -%}
        {%- assign is_color_option = false -%}
        {%- for color_word in color_label -%}
          {%- if downcase_option contains color_word -%}
            {%- assign is_color_option = true -%}
            {%- break -%}
          {%- endif -%}
        {%- endfor -%}

        {%- comment -%}Check if option name contains "texture" or "finish"{%- endcomment -%}
        {%- assign is_texture_option = false -%}
        {%- for texture_word in texture_label -%}
          {%- if downcase_option contains texture_word -%}
            {%- assign is_texture_option = true -%}
            {%- break -%}
          {%- endif -%}
        {%- endfor -%}

        {%- comment -%}Check if option name contains "size"{%- endcomment -%}
        {%- if downcase_option contains 'size' -%}
          {%- assign is_size_option = true -%}
        {%- endif -%}

        {%- if is_color_option -%}
          {%- assign metafield_swatch_key = 'color_swatch_image' -%}
          {%- comment -%}Check if any variant has this metafield{%- endcomment -%}
          {%- for variant in product.variants limit: 1 -%}
            {%- if variant.metafields.custom.color_swatch_image != blank -%}
              {%- assign has_metafield_swatches = true -%}
            {%- endif -%}
          {%- endfor -%}
        {%- elsif is_texture_option -%}
          {%- assign metafield_swatch_key = 'texture_swatch_image' -%}
          {%- comment -%}Check if any variant has this metafield{%- endcomment -%}
          {%- for variant in product.variants limit: 1 -%}
            {%- if variant.metafields.custom.texture_swatch_image != blank -%}
              {%- assign has_metafield_swatches = true -%}
            {%- endif -%}
          {%- endfor -%}
        {%- elsif is_size_option -%}
          {%- assign metafield_swatch_key = 'size_info' -%}
          {%- comment -%}Check if any variant has size_info metafield{%- endcomment -%}
          {%- for variant in product.variants limit: 1 -%}
            {%- if variant.metafields.custom.size_info != blank -%}
              {%- assign has_metafield_swatches = true -%}
            {%- endif -%}
          {%- endfor -%}
        {%- endif -%}

        {%- if has_metafield_swatches -%}
          {%- comment -%}Force variant swatch mode for metafield swatches{%- endcomment -%}
          {%- assign option_selector_type = 'metafield-variant' -%}
        {%- elsif swatch_count > 0 and block.settings.color_mode == 'swatch' %}
          {%- assign option_selector_type = 'swatch' -%}
        {%- elsif swatch_count == 0 and color_label contains downcase_option and block.settings.color_mode != 'none' %}
          {%- assign option_selector_type = 'swatch' -%}
        {%- elsif variant_image_options contains downcase_option -%}
          {%- assign option_selector_type = 'variant' -%}
        {%- endif -%}

        <div class="product-form__option">
          {%- case option_selector_type -%}
            {%- comment -%}
            ============================================
            CUSTOM: Metafield-based Variant Swatches
            ============================================
            {%- endcomment -%}
            {%- when 'metafield-variant' -%}
              <span class="product-form__option-name text--strong">{{ option.name }}: <span class="product-form__selected-value">{{ option.selected_value }}</span></span>

              <div class="variant-swatch-list variant-swatch-list--metafield">
                {%- for value in option.values -%}
                  {%- capture variant_swatch_id -%}{{ product_form_id }}-{{ option_name }}-{{ forloop.index }}{%- endcapture -%}

                  {%- comment -%}Find first variant with this option value and get its swatch image{%- endcomment -%}
                  {%- assign swatch_url = nil -%}
                  {%- assign size_dimensions = nil -%}
                  {%- for variant in product.variants -%}
                    {%- if variant.option1 == value or variant.option2 == value or variant.option3 == value -%}
                      {%- if metafield_swatch_key == 'size_info' -%}
                        {%- comment -%}Handle size_info JSON metafield{%- endcomment -%}
                        {%- if variant.metafields.custom.size_info != blank -%}
                          {%- assign size_data = variant.metafields.custom.size_info.value -%}
                          {%- if size_data.diagram_image != blank -%}
                            {%- assign swatch_url = size_data.diagram_image -%}
                          {%- endif -%}
                          {%- if size_data.dimensions != blank -%}
                            {%- assign size_dimensions = size_data.dimensions -%}
                          {%- endif -%}
                          {%- break -%}
                        {%- endif -%}
                      {%- else -%}
                        {%- comment -%}Handle regular image metafields{%- endcomment -%}
                        {%- assign swatch_url = variant.metafields.custom[metafield_swatch_key].value -%}
                        {%- if swatch_url != blank -%}
                          {%- break -%}
                        {%- endif -%}
                      {%- endif -%}
                    {%- endif -%}
                  {%- endfor -%}

                  {%- comment -%}Fallback to product featured image if no swatch found{%- endcomment -%}
                  {%- if swatch_url == blank -%}
                    {%- assign swatch_url = product.featured_media | image_url: width: 120 -%}
                  {%- endif -%}

                  {%- comment -%}Build title with dimensions if available{%- endcomment -%}
                  {%- capture swatch_title -%}
                    {%- if size_dimensions != blank -%}
                      {{ value | escape }} - {{ size_dimensions | replace: '\n', ' | ' }}
                    {%- else -%}
                      {{ value | escape }}
                    {%- endif -%}
                  {%- endcapture -%}

                  <div class="variant-swatch variant-swatch--metafield {% unless value.available %}variant-swatch--disabled{% endunless %}">
                    {%- if value.product_url != blank -%}
                      {%- if value == option.selected_value -%}
                        <input type="hidden" name="{{ option_name }}" form="{{ product_form_id }}" value="{{ value.id }}" data-option-position="{{ option.position }}">
                      {%- endif -%}

                      <a href="{{ value.product_url }}" class="variant-swatch__item {% if value == option.selected_value %}is-selected{% endif %}" title="{{ swatch_title }}">
                        <div class="aspect-ratio aspect-ratio--square">
                          <img src="{{ swatch_url }}" loading="lazy" alt="{{ value | escape }}" width="120" height="120">
                        </div>
                        {%- comment -%}Removed sold-out X icon{%- endcomment -%}
                      </a>
                    {%- else -%}
                      <input class="variant-swatch__radio product-form__single-selector" type="radio" name="{{ option_name }}" id="{{ variant_swatch_id }}" value="{{ value.id }}" form="{{ product_form_id }}" {% if option.selected_value == value %}checked{% endif %} data-option-position="{{ option.position }}">

                      <label class="variant-swatch__item" for="{{ variant_swatch_id }}" title="{{ swatch_title }}">
                        <div class="aspect-ratio aspect-ratio--square">
                          <img src="{{ swatch_url }}" loading="lazy" alt="{{ value | escape }}" width="120" height="120">
                        </div>
                        {%- comment -%}Removed sold-out X icon{%- endcomment -%}
                      </label>
                    {%- endif -%}

                    {%- comment -%}Add option name label below swatch{%- endcomment -%}
                    <div class="variant-swatch__label">
                      {{ value | escape }}
                    </div>

                    {%- comment -%}Add dimensions description for size options{%- endcomment -%}
                    {%- if size_dimensions != blank -%}
                      <div class="variant-swatch__description">
                        {%- comment -%}Replace newline character (not escaped string) with <br>{%- endcomment -%}
                        {%- assign dimensions_lines = size_dimensions | split: '
' -%}
                        {%- for line in dimensions_lines -%}
                          {{ line | strip }}{%- unless forloop.last -%}<br>{%- endunless -%}
                        {%- endfor -%}
                      </div>
                    {%- endif -%}
                  </div>
                {%- endfor -%}
              </div>

            {%- comment -%}
            ============================================
            ORIGINAL: Shopify Native Color Swatches
            ============================================
            {%- endcomment -%}
            {%- when 'swatch' -%}
              <span class="product-form__option-name text--strong">{{ option.name }}: <span class="product-form__selected-value">{{ option.selected_value }}</span></span>

              <div class="color-swatch-list color-swatch-list--large">
                {%- assign color_swatch_config = settings.color_swatch_config | newline_to_br | split: '<br />' -%}

                {%- for value in option.values -%}
                  {%- assign downcased_value = value | downcase -%}
                  {%- capture color_id -%}{{ product_form_id }}-{{ option_name }}-{{ forloop.index }}{%- endcapture -%}

                  <div class="color-swatch {% if downcased_value == 'white' or downcased_value == 'blanc' %}color-swatch--white{% endif %} {% unless value.available %}color-swatch--disabled{% endunless %}">
                    {%- if value.product_url != blank -%}
                      {%- if value == option.selected_value -%}
                        <input type="hidden" name="{{ option_name }}" form="{{ product_form_id }}" value="{{ value.id }}" data-option-position="{{ option.position }}">
                      {%- endif -%}

                      <a href="{{ value.product_url }}" class="color-swatch__item {% if value == option.selected_value %}is-selected{% endif %}" style="{% render 'color-swatch-style', swatch: value.swatch, color_swatch_config: color_swatch_config, value: downcased_value %}" title="{{ value | escape }}">
                        <span class="visually-hidden">{{ value }}</span>
                        {%- render 'icon', icon: 'cross-sold-out' -%}
                      </a>
                    {%- else -%}
                      <input class="color-swatch__radio product-form__single-selector" type="radio" name="{{ option_name }}" id="{{ color_id }}" value="{{ value.id }}" {% if option.selected_value == value %}checked{% endif %} data-option-position="{{ option.position }}" form="{{ product_form_id }}">
                      <label class="color-swatch__item" for="{{ color_id }}" style="{% render 'color-swatch-style', swatch: value.swatch, color_swatch_config: color_swatch_config, value: downcased_value %}" title="{{ value | escape }}">
                        <span class="visually-hidden">{{ value }}</span>
                        {%- render 'icon', icon: 'cross-sold-out' -%}
                      </label>
                    {%- endif -%}
                  </div>
                {%- endfor -%}
              </div>

            {%- comment -%}
            ============================================
            ORIGINAL: Variant Image Swatches
            ============================================
            {%- endcomment -%}
            {%- when 'variant' -%}
              <span class="product-form__option-name text--strong">{{ option.name }}: <span class="product-form__selected-value">{{ option.selected_value }}</span></span>

              <div class="variant-swatch-list">
                {%- for value in option.values -%}
                  {%- capture variant_swatch_id -%}{{ product_form_id }}-{{ option_name }}-{{ forloop.index }}{%- endcapture -%}

                  {%- liquid
                    assign image = value.variant.featured_media
                    assign option_name = 'option' | append: option.position
                  
                    if value.variant.featured_media == blank
                      for variant in product.variants
                        if variant[option_name] == value
                          assign image = variant.featured_media
                          break
                        endif
                      endfor
                    endif

                    assign image = image | default: product.featured_media
                  -%}

                  <div class="variant-swatch {% unless value.available %}variant-swatch--disabled{% endunless %}">
                    {%- if value.product_url != blank -%}
                      {%- if value == option.selected_value -%}
                        <input type="hidden" name="{{ option_name }}" form="{{ product_form_id }}" value="{{ value.id }}" data-option-position="{{ option.position }}">
                      {%- endif -%}

                      <a href="{{ value.product_url }}" class="variant-swatch__item {% if value == option.selected_value %}is-selected{% endif %}" title="{{ value | escape }}">
                        <div class="aspect-ratio" style="padding-bottom: {{ 100.0 | divided_by: image.aspect_ratio }}%">
                          {{- image | image_url: width: image.width | image_tag: loading: 'lazy', sizes: '120px', widths: '120,240' -}}
                        </div>

                        {% render 'icon', icon: 'cross-sold-out' %}
                      </a>
                    {%- else -%}
                      <input class="variant-swatch__radio product-form__single-selector" type="radio" name="{{ option_name }}" id="{{ variant_swatch_id }}" value="{{ value.id }}" form="{{ product_form_id }}" {% if option.selected_value == value %}checked{% endif %} data-option-position="{{ option.position }}">

                      <label class="variant-swatch__item" for="{{ variant_swatch_id }}" title="{{ value | escape }}">
                        <div class="aspect-ratio" style="padding-bottom: {{ 100.0 | divided_by: image.aspect_ratio }}%">
                          {{- image | image_url: width: image.width | image_tag: loading: 'lazy', sizes: '120px', widths: '120,240' -}}
                        </div>

                        {% render 'icon', icon: 'cross-sold-out' %}
                      </label>
                    {%- endif -%}
                  </div>
                {%- endfor -%}
              </div>

            {%- when 'block' -%}
              <span class="product-form__option-name text--strong">{{ option.name }}: <span class="product-form__selected-value">{{ option.selected_value }}</span></span>

              <div class="block-swatch-list">
                {%- for value in option.values -%}
                  {%- capture block_swatch_id -%}{{ product_form_id }}-{{ option_name }}-{{ forloop.index }}{%- endcapture -%}

                  <div class="block-swatch {% unless value.available %}block-swatch--disabled{% endunless %}">
                    {%- if value.product_url != blank -%}
                      {%- if value == option.selected_value -%}
                        <input type="hidden" name="{{ option_name }}" form="{{ product_form_id }}" value="{{ value.id }}" data-option-position="{{ option.position }}">
                      {%- endif -%}

                      <a href="{{ value.product_url }}" class="block-swatch__item {% if value == option.selected_value %}is-selected{% endif %}" title="{{ value | escape }}">
                        {{- value -}}
                        {%- render 'icon', icon: 'cross-sold-out' -%}
                      </a>
                    {%- else -%}
                      <input class="block-swatch__radio product-form__single-selector" type="radio" name="{{ option_name }}" id="{{ block_swatch_id }}" value="{{ value.id }}" form="{{ product_form_id }}" {% if option.selected_value == value %}checked{% endif %} data-option-position="{{ option.position }}">

                      <label class="block-swatch__item" for="{{ block_swatch_id }}" title="{{ value | escape }}">
                        {{- value -}}
                        {%- render 'icon', icon: 'cross-sold-out' -%}
                      </label>
                    {%- endif -%}
                  </div>
                {%- endfor -%}
              </div>

            {%- else -%}
              <label class="product-form__option-name" for="{{ product_form_id }}-{{ option_name }}">{{ option.name }}:</label>

              <div class="select-wrapper select-wrapper--primary">
                <svg class="icon icon--arrow-down" viewBox="0 0 10 6" role="presentation">
                  <path fill-rule="evenodd" clip-rule="evenodd" d="M9.354.646a.5.5 0 00-.708 0L5 4.293 1.354.646a.5.5 0 00-.708.708l4 4a.5.5 0 00.708 0l4-4a.5.5 0 000-.708z" fill="currentColor"></path>
                </svg>

                <select name="{{ option_name }}" id="{{ product_form_id }}-{{ option_name }}" form="{{ product_form_id }}" class="product-form__single-selector" data-option-position="{{ option.position }}">
                  {%- for value in option.values -%}
                    <option value="{{ value.id }}" {% if option.selected_value == value %}selected{% endif %}>{{ value }}{% unless value.available %} - {{ 'product.form.sold_out_badge' | t }}{% endunless %}</option>
                  {%- endfor -%}
                </select>
              </div>
          {%- endcase -%}
        </div>
      {%- endfor -%}
    {%- endif -%}
  </variant-picker>
{%- endunless -%}

{%- comment -%}Only show prices/inventory/quantity if hide_online_price is NOT true{%- endcomment -%}
{%- if hide_online_price != true -%}
  {%- if product.template_suffix != 'pre-order' or block.settings.show_price_for_pre_orders -%}
    <div class="product-form__info-item">
      <span class="product-form__info-title text--strong">{{ 'product.form.price' | t }}:</span>

      <div class="product-form__info-content">
        <div class="price-list">
          {%- comment -%}Always show selected variant price, not range{%- endcomment -%}
          <span class="price {% if selected_variant.compare_at_price > selected_variant.price %}price--highlight{% endif %}">
            {%- if selected_variant.compare_at_price > selected_variant.price -%}
              <span class="sr-only">{{ 'product.general.sale_price' | t }}</span>
            {%- endif -%}

            {{- selected_variant.price | money -}}
          </span>

          {%- if block.settings.show_compare_at_price and selected_variant.compare_at_price > selected_variant.price -%}
            <span class="price price--compare">
              <span class="sr-only">{{ 'product.general.regular_price' | t }}</span>

              {%- if product.price_varies -%}
                {%- if product.compare_at_price_max > product.price_min -%}
                  {{- product.compare_at_price_max | money -}}
                {%- endif -%}
              {%- else -%}
                {{- selected_variant.compare_at_price | money -}}
              {%- endif -%}
            </span>
          {%- endif -%}
        </div>

        {%- assign variant_to_use = selected_variant | default: product.selected_or_first_available_variant -%}

        {%- if variant_to_use.unit_price -%}
          <div class="product-form__price-info">
            <div class="unit-price-measurement">
              {{- variant_to_use.unit_price | unit_price_with_measurement: variant_to_use.unit_price_measurement -}}
            </div>
          </div>
        {%- endif -%}

        {{- form | payment_terms -}}

        {%- if block.settings.show_taxes_included -%}
          {%- if cart.taxes_included or shop.shipping_policy.body != blank -%}
            <p class="product-form__price-info">
              {%- if cart.taxes_included -%}
                {{ 'product.general.include_taxes' | t }}
              {%- endif -%}

              {%- if shop.shipping_policy.body != blank -%}
                {{ 'product.general.shipping_policy_html' | t: link: shop.shipping_policy.url }}
              {%- endif -%}
            </p>
          {%- endif -%}
        {%- endif -%}
      </div>
    </div>
  {%- endif -%}

  {%- if block.settings.show_inventory_quantity and product.template_suffix != 'pre-order' and product.selected_or_first_available_variant != nil -%}
    <div class="product-form__info-item">
      <span class="product-form__info-title text--strong">{{ 'product.form.inventory' | t }}:</span>

      <div class="product-form__info-content">
        {%- if selected_variant.inventory_management -%}
          {%- if selected_variant.available -%}
            {%- if selected_variant.inventory_quantity <= 0 and selected_variant.requires_shipping -%}
              {%- if selected_variant.incoming -%}
                {%- capture next_incoming_date -%}{{ selected_variant.next_incoming_date | date: format: 'date' }}{%- endcapture -%}
                <span class="product-form__inventory inventory inventory--high">{{ 'product.form.incoming_stock' | t: next_incoming_date: next_incoming_date }}</span>
              {%- else -%}
                <span class="product-form__inventory inventory inventory--high">{{ 'product.form.oversell_stock' | t }}</span>
              {%- endif -%}
            {%- elsif block.settings.low_inventory_threshold > 0 -%}
              {%- if selected_variant.inventory_quantity <= block.settings.low_inventory_threshold -%}
                <span class="product-form__inventory inventory inventory--low">{{ 'product.form.low_stock_with_quantity_count' | t: count: selected_variant.inventory_quantity }}</span>
              {%- else -%}
                <span class="product-form__inventory inventory inventory--high">{{ 'product.form.in_stock_with_quantity_count' | t: count: selected_variant.inventory_quantity }}</span>
              {%- endif -%}
            {%- else -%}
              <span class="product-form__inventory inventory inventory--high">{{ 'product.form.in_stock' | t }}</span>
            {%- endif -%}
          {%- else -%}
            {%- if selected_variant.incoming -%}
              {%- capture next_incoming_date -%}{{ selected_variant.next_incoming_date | date: format: 'date' }}{%- endcapture -%}
              <span class="product-form__inventory inventory">{{ 'product.form.incoming_stock' | t: next_incoming_date: next_incoming_date }}</span>
            {%- else -%}
              <span class="product-form__inventory inventory">{{ 'product.form.sold_out' | t }}</span>
            {%- endif -%}
          {%- endif -%}
        {%- else -%}
          <span class="product-form__inventory inventory inventory--high">{{ 'product.form.in_stock' | t }}</span>
        {%- endif -%}

        {%- for tag in product.tags -%}
          {%- if tag contains '__stock:' -%}
            {%- assign stock_countdown_max = tag | split: '__stock:' | last | times: 1.0 -%}
            {%- break -%}
          {%- endif -%}
        {%- endfor -%}

        {%- comment -%}
        Historically the theme used a tag based approach instead of a setting. We keep this for compatibility, but then fallback to the setting,
        which allows a simpler setup
        {%- endcomment -%}
        {%- assign stock_countdown_max = stock_countdown_max | default: block.settings.progress_bar_max_value | times: 1.0 -%}

        <progress-bar class="inventory-bar" data-variant-inventory="{{ selected_variant.inventory_quantity }}" data-stock-countdown-max="{{ stock_countdown_max }}">
          <span class="inventory-bar__progress" style="width: 100%"></span>
        </progress-bar>
      </div>
    </div>
  {%- endif -%}

  {%- if product.template_suffix != 'contact' -%}
    {%- if block.settings.show_quantity_selector -%}
      <div class="product-form__info-item product-form__info-item--quantity">
        <label for="{{ section.id }}-{{ product.id }}-quantity" class="product-form__info-title text--strong">{{ 'product.form.quantity' | t }}:</label>

        <div class="product-form__info-content">
          {%- assign variant = product.selected_or_first_available_variant -%}
          
          <div class="product-form__quantity-with-rules">
            <quantity-picker class="quantity-selector quantity-selector--product">
              <button type="button" class="quantity-selector__button" data-action="decrease-picker-quantity" aria-label="{{ 'cart.items.decrease_quantity' | t }}" title="{{ 'cart.items.decrease_quantity' | t }}">{% render 'icon', icon: 'minus' %}</button>
              <input id="{{ section.id }}-{{ product.id }}-quantity" type="number" name="quantity" aria-label="{{ 'product.form.quantity' | t }}" class="quantity-selector__value" inputmode="numeric" value="{{ variant.quantity_rule.min | default: 1 }}" step="{{ variant.quantity_rule.increment }}" min="{{ variant.quantity_rule.min }}" {% if variant.quantity_rule.max != nil %}max="{{ variant.quantity_rule.max }}"{% endif %}>
              <button type="button" class="quantity-selector__button" data-action="increase-picker-quantity" aria-label="{{ 'cart.items.increase_quantity' | t }}" title="{{ 'cart.items.increase_quantity' | t }}">{% render 'icon', icon: 'plus' %}</button>
            </quantity-picker>
  
            {%- liquid
              assign variant = product.selected_or_first_available_variant
              assign quantity_rules = ''
  
              if variant.quantity_rule.min > 1
                assign rule = 'product.quantity.minimum_of' | t: min: variant.quantity_rule.min
                assign quantity_rules = quantity_rules | append: ' / ' | append: rule
              endif
  
              if variant.quantity_rule.max != nil
                assign rule = 'product.quantity.maximum_of' | t: max: variant.quantity_rule.max
                assign quantity_rules = quantity_rules | append: ' / ' | append: rule
              endif
  
              if variant.quantity_rule.increment > 1
                assign rule = 'product.quantity.increment_of' | t: step: variant.quantity_rule.increment
                assign quantity_rules = quantity_rules | append: ' / ' | append: rule
              endif
            -%}
  
            {%- if quantity_rules != blank -%}
              <p class="product-form__quantity-rules text--small">{{ quantity_rules | remove_first: ' / ' | capitalize }}</p>
            {%- endif -%}
          </div>
        </div>
      </div>
    {%- else -%}
      <input type="hidden" name="quantity" value="1">
    {%- endif -%}
  {%- endif -%}
{%- else -%}
  {%- comment -%}When hide_online_price is true, include hidden quantity input for JavaScript compatibility{%- endcomment -%}
  <input type="hidden" name="quantity" value="1">
{%- endif -%}
